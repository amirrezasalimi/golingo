var N="http://localhost:3001/";var f=function(z,J){let K;return function(...Y){const Z=this;clearTimeout(K),K=setTimeout(()=>{z.apply(Z,Y)},J)}},x=function(z){const J=[];let K=z;while(K?.parentNode){const Y=K.parentNode,Z=Array.from(Y.childNodes).filter((X)=>X.nodeName===K?.nodeName).length;let B=0;if(Z>1)B=Array.from(Y.childNodes).indexOf(K)-Array.from(Y.childNodes).indexOf(K?.nodeName==="#text"?K.previousSibling:K);if(Y.nodeType===1){const X=Y.getAttribute("id");let Q=(Y.nodeName||"").toLowerCase();if(X&&X!=="")Q+=`#${X}`;else if(Z>1)Q+=`:nth-child(${B+1})`;J.unshift(Q)}K=K.parentNode}return J.slice(1).join(" > ").replace(/:nth-child\(1\)/,"")||""},m=function(z){let J=0;if(z.length===0)return J.toString();for(let K=0;K<z.length;K++){const Y=z.charCodeAt(K);J=(J<<5)-J+Y,J=J&J}return Math.abs(J).toString(16)},q="golingo_highlighted",A=(z,J)=>{let K=[];const Y=z?.tagName?.toLowerCase()??"";if(z.nodeType===3){const Z=(z.nodeValue||"").trim();if(Z.length<=2)return[];if(Z!==""){const B=z.parentNode.classList.contains(q);let X;if(B)X=z.parentNode;else{X=document.createElement("span");const G=m(Z);X.id=`${q}_${G}`,X.className=q,X.textContent=Z}const Q=x(z.parentNode);if(z.parentNode&&!B)z.parentNode.replaceChild(X,z);const $={wrapperId:X.id,position:Q,text:Z};K.push($)}}else if(z.nodeType===1&&!J.includes(Y)){const Z=z;for(let B=0;B<Z.childNodes.length;B++){let X=A(Z.childNodes[B],J);K.push(...X)}}return K},b=async(z,J)=>{const Y=await(await fetch(`${N}api/tr?code=${z}&path=${J}`)).json();return{translates:Y.translates,mainLang:Y.mainLang}};var _=function(z){return typeof z==="object"&&z!==null&&"$on"in z&&typeof z.$on==="function"};var L=function(z,J={}){if(_(z)||typeof z!=="object")return z;const K=J.o||new Map,Y=J.op||new Map,Z=Array.isArray(z),B=[],X=Z?[]:Object.create(z,{});for(let W in z){const H=z[W];if(typeof H==="object"&&H!==null)X[W]=!_(H)?L(H):H,B.push(W);else X[W]=H}const Q=(W)=>(H,O)=>{let M=K.get(H),F=Y.get(O);if(!M)M=new Set,K.set(H,M);if(!F)F=new Set,Y.set(O,F);M[W](O),F[W](H)},$=Q("add"),G=Q("delete"),j=(W,H,O)=>{K.has(W)&&K.get(W).forEach((M)=>M(H,O))},E={$on:$,$off:G,_em:j,_st:()=>{return{o:K,op:Y,r:X,p:U._p}},_p:void 0},U=new Proxy(X,{has(W,H){return H in E||H in W},get(...W){const[,H]=W;if(Reflect.has(E,H))return Reflect.get(E,H);const O=Reflect.get(...W);if(k(U,H),Z&&H in Array.prototype)return h(H,X,U,O);return O},set(...W){const[H,O,M]=W,F=Reflect.get(H,O);if(Reflect.has(E,O))return Reflect.set(E,O,M);if(M&&_(F)){const I=F,C=I._st(),V=_(M)?u(M,I):L(M,C);return Reflect.set(H,O,V),j(O,V),C.o.forEach((p,R)=>{const w=Reflect.get(F,R),T=Reflect.get(V,R);if(w!==T)I._em(R,T,w)}),!0}const S=Reflect.set(...W);if(S){if(F!==M)j(O,M,F);if(U._p)U._p[1]._em(...U._p)}return S}});if(J.p)U._p=J.p;return B.map((W)=>{U[W]._p=[W,U]}),U},k=function(z,J){g.forEach((K)=>{let Y=K.get(z);if(!Y)Y=new Set,K.set(z,Y);Y.add(J)})},h=function(z,J,K,Y){const Z=(...B)=>{const X=Array.prototype[z].call(J,...B);if(J.forEach((Q,$)=>K._em(String($),Q)),K._p){const[Q,$]=K._p;$._em(Q,K)}return X};switch(z){case"shift":case"pop":case"sort":case"reverse":case"copyWithin":return Z;case"unshift":case"push":case"fill":return(...B)=>Z(...B.map((X)=>L(X)));case"splice":return(B,X,...Q)=>Z(B,X,...Q.map(($)=>L($)));default:return Y}},u=function(z,J){const K=J._st();if(K.o)K.o.forEach((Y,Z)=>{Y.forEach((B)=>{z.$on(Z,B)})});if(K.p)z._p=K.p;return z};var g=new Map;var c="\u27B3\u274D",i="\u274D\u21DA",t=`<!--${c}-->`,a=`<!--${i}-->`;var v=L;class D{static messageResponseHandlers=[];static listenMessages(z,J,K){const Y=async(B)=>{const X=B.data;if(console.log("## GoLingo: message",X,B),X&&X.uid&&X.functionName){const Q=K?.origin||"*";if(!X.isResponse){if(typeof X?.timeout!="undefined")return;const $=setTimeout(()=>{z.postMessage({uid:X.uid,functionName:X.functionName,timeout:!0},Q)},K?.timeout||2000);try{const G=await J(X);console.log("## GoLingo: res",X,G),z.postMessage({uid:X.uid,functionName:X.functionName,response:G,isResponse:!0},Q)}catch(G){z.postMessage({uid:X.uid,functionName:X.functionName,response:G,isResponse:!0},Q)}clearTimeout($)}else{const $=this.messageResponseHandlers.find((G)=>G.uid===X.uid);if($)$.callback(X.response),console.log("## GoLingo: message.response",X.response),this.messageResponseHandlers=this.messageResponseHandlers.filter((G)=>G.uid!==X.uid)}}};return window.addEventListener("message",Y),()=>{window.removeEventListener("message",Y)}}static async sendMessage(z,J,K=null,Y){const Z=Math.random().toString(36).substring(7);z.postMessage({uid:Z,functionName:J,args:K},"*"),this.messageResponseHandlers.push({uid:Z,functionName:J,callback:Y})}static async send(z,J,K=null){return new Promise((Y)=>{D.sendMessage(z,J,K,(Z)=>{Y(Z)})})}static getInstance(z){return{send:(J,K)=>{return D.send(z,J,K)},listen:(J,K)=>{return D.listenMessages(z,J,K)}}}}var P=D;class y{constructor(){}code=null;ignoredTags=["iframe","img","style","script","meta","link","head","html","noscript","audio","video","object","canvas","svg","map","area","embed","param","track","source"];data=v({currentLang:null,mainLang:null,translates:{},devMode:!1,selectedTextItem:null,initialized:!1,currentOvrerideLang:null,oldTranslatedPath:null,oldTranslatedLang:null});async init({code:z}){if(!z){console.error("## GoLingo Error: code is required");return}if(this.data.initialized){console.info("## GoLingo Error: already initialized");return}this.code=z;const K=new URLSearchParams(window.location.search).get("golingoDev")?!0:!1;if(this.data.devMode=K,K)this.addStyle(),this.listenDevMethods();else this.productionModeListeners();this.observeDOMChanges(),this.data.initialized=!0}addStyle(){if(document.getElementById("golingo-styles"))return;const J=document.createElement("style");J.id="golingo-styles",J.innerHTML=`
            .golingo_highlighted { background-color: #ffff3b24;border: solid 1px #ffff1d; }
            .golingo_disabled { background-color: #afafaf1c;border: solid 1px #818181; }
            .golingo_selected { background-color: #2583c240 !important;border: solid 1px #1d6cd4 !important; }
        `,document.head.appendChild(J)}productionModeListeners(){document.onreadystatechange=async()=>{if(console.log("## GoLingo: document.readyState",document.readyState),document.readyState=="complete")await this.startTranslate()},window.onload=async()=>{await this.startTranslate()};const z=()=>{console.log("Route changed")};window.addEventListener("popstate",z),window.addEventListener("hashchange",z)}listenDevMethods(){const J=P.getInstance(window.parent).listen(async(K)=>{const{uid:Y,functionName:Z,args:B}=K;switch(console.log("## GoLingo: devMethod",K),Z){case"identifyTexts":return await this.identifyTexts(),this.data.identifiedTexts;case"overrideTexts":const X=B;if(X){this.data.currentOvrerideLang=X,this.data.currentLang=X;const $=this.getPath(),G=this.data.translates[$][X].texts;console.log("## GoLingo: dev | overrideTexts ",X,JSON.parse(JSON.stringify(this.data.translates,null,2))),this.overrideTexts(G)}break;case"syncTranslations":const Q=B;if(console.log("## GoLingo: dev",Q),Q){const{mainLang:$,translations:G}=Q,j=this.getPath();this.data.mainLang=$,this.data.translates[j]=G}break}});window.addEventListener("beforeunload",()=>{J()})}async identifyTexts(){return this.data.identifiedTexts=A(document.body,this.ignoredTags),this.data.identifiedTexts}overrideTexts(z){if(!this.data.currentLang)return;z.forEach((J)=>{document.querySelectorAll(`#${J.wrapperId}`).forEach((Y)=>{if(Y&&this.ignoredTags.includes(Y.tagName.toLowerCase()))return;if(Y&&J.text!=Y.textContent)Y.textContent=J.text})})}syncTextsWithPanel(){if(this.data.mainLang==this.data.currentLang){const z=this.data.identifiedTexts;this.postDev("syncTexts",z)}}syncInternalLinksWithPanel(){const z=document.querySelectorAll("a"),J=[];z.forEach((Y)=>{let Z=Y.getAttribute("href")??"";if(Z=Z?.split("?")[0],Z=Z?.split("#")[0],Z&&Z.startsWith("/"))J.push(Z);if(Z&&Z.startsWith(window.location.origin))J.push(Z)});const K=[...new Set(J)];this.postDev("syncLinks",K)}async observeDOMChangesHandler(){if(console.log("## GoLingo: observeDOMChangesHandler"),await this.identifyTexts(),this.data.devMode)this.syncInternalLinksWithPanel(),this.syncTextsWithPanel()}observeDOMChangesDebounced=f(this.observeDOMChangesHandler,300);observeDOMChanges(){new MutationObserver((J,K)=>{this.observeDOMChangesDebounced()}).observe(document.body,{childList:!0,subtree:!0})}getPath(){return window.location.pathname}async postDev(z,J){await P.getInstance(window.parent).send(z,J)}getLocalLang(){const z=navigator.language.split("-"),J=z[0].toLocaleLowerCase(),K=z[1].toLocaleLowerCase();return[J,K]}goLingoLangStorageKey="golingoSelectedLang";getStorageSelectedLang(){return localStorage.getItem(this.goLingoLangStorageKey)}setStorageSelectedLang(z){localStorage.setItem(this.goLingoLangStorageKey,z)}detectCurrentLang(){const z=this.getPath();let J=this.getStorageSelectedLang();if(!this.data.translates?.[z]?.[J])J=this.getLocalLang()[0];this.setCurrentLang(J)}setCurrentLang(z){if(!z)return;this.setStorageSelectedLang(z),this.data.currentLang=z}async loadTranslatesData(){const z=this.getPath(),J=this.code;if(J){const K=await b(J,z);this.data.translates[z]=K}}async startTranslate(){return}}var d=new y;window.golingo=d;
