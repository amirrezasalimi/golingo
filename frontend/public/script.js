var N=function(z,H){let J;return function(...X){const Y=this;clearTimeout(J),J=setTimeout(()=>{z.apply(Y,X)},H)}},y=function(z){const H=[];let J=z;while(J?.parentNode){const X=J.parentNode,Y=Array.from(X.childNodes).filter((K)=>K.nodeName===J?.nodeName).length;let Z=0;if(Y>1)Z=Array.from(X.childNodes).indexOf(J)-Array.from(X.childNodes).indexOf(J?.nodeName==="#text"?J.previousSibling:J);if(X.nodeType===1){const K=X.getAttribute("id");let O=(X.nodeName||"").toLowerCase();if(K&&K!=="")O+=`#${K}`;else if(Y>1)O+=`:nth-child(${Z+1})`;H.unshift(O)}J=J.parentNode}return H.slice(1).join(" > ").replace(/:nth-child\(1\)/,"")||""},x=function(z){let H=0;if(z.length===0)return H.toString();for(let J=0;J<z.length;J++){const X=z.charCodeAt(J);H=(H<<5)-H+X,H=H&H}return Math.abs(H).toString(16)},q="golingo_highlighted",A=(z,H)=>{let J=[];const X=z?.tagName?.toLowerCase()??"";if(z.nodeType===3){const Y=(z.nodeValue||"").trim();if(Y.length<=2)return[];if(Y!==""){const Z=z.parentNode.classList.contains(q);let K;if(Z)K=z.parentNode;else{K=document.createElement("span");const Q=x(Y);K.id=`${q}_${Q}`,K.className=q,K.textContent=Y}const O=y(z.parentNode);if(z.parentNode&&!Z)z.parentNode.replaceChild(K,z);const B={wrapperId:K.id,position:O,text:Y};J.push(B)}}else if(z.nodeType===1&&!H.includes(X)){const Y=z;for(let Z=0;Z<Y.childNodes.length;Z++){let K=A(Y.childNodes[Z],H);J.push(...K)}}return J},f=async(z,H,J)=>{const Y=await(await fetch(`${z}api/tr?code=${H}&path=${J}`)).json();return{translates:Y.translates,mainLang:Y.mainLang}};var _=function(z){return typeof z==="object"&&z!==null&&"$on"in z&&typeof z.$on==="function"};var D=function(z,H={}){if(_(z)||typeof z!=="object")return z;const J=H.o||new Map,X=H.op||new Map,Y=Array.isArray(z),Z=[],K=Y?[]:Object.create(z,{});for(let $ in z){const G=z[$];if(typeof G==="object"&&G!==null)K[$]=!_(G)?D(G):G,Z.push($);else K[$]=G}const O=($)=>(G,M)=>{let W=J.get(G),F=X.get(M);if(!W)W=new Set,J.set(G,W);if(!F)F=new Set,X.set(M,F);W[$](M),F[$](G)},B=O("add"),Q=O("delete"),j=($,G,M)=>{J.has($)&&J.get($).forEach((W)=>W(G,M))},E={$on:B,$off:Q,_em:j,_st:()=>{return{o:J,op:X,r:K,p:U._p}},_p:void 0},U=new Proxy(K,{has($,G){return G in E||G in $},get(...$){const[,G]=$;if(Reflect.has(E,G))return Reflect.get(E,G);const M=Reflect.get(...$);if(g(U,G),Y&&G in Array.prototype)return k(G,K,U,M);return M},set(...$){const[G,M,W]=$,F=Reflect.get(G,M);if(Reflect.has(E,M))return Reflect.set(E,M,W);if(W&&_(F)){const I=F,C=I._st(),V=_(W)?h(W,I):D(W,C);return Reflect.set(G,M,V),j(M,V),C.o.forEach((l,R)=>{const w=Reflect.get(F,R),T=Reflect.get(V,R);if(w!==T)I._em(R,T,w)}),!0}const S=Reflect.set(...$);if(S){if(F!==W)j(M,W,F);if(U._p)U._p[1]._em(...U._p)}return S}});if(H.p)U._p=H.p;return Z.map(($)=>{U[$]._p=[$,U]}),U},g=function(z,H){m.forEach((J)=>{let X=J.get(z);if(!X)X=new Set,J.set(z,X);X.add(H)})},k=function(z,H,J,X){const Y=(...Z)=>{const K=Array.prototype[z].call(H,...Z);if(H.forEach((O,B)=>J._em(String(B),O)),J._p){const[O,B]=J._p;B._em(O,J)}return K};switch(z){case"shift":case"pop":case"sort":case"reverse":case"copyWithin":return Y;case"unshift":case"push":case"fill":return(...Z)=>Y(...Z.map((K)=>D(K)));case"splice":return(Z,K,...O)=>Y(Z,K,...O.map((B)=>D(B)));default:return X}},h=function(z,H){const J=H._st();if(J.o)J.o.forEach((X,Y)=>{X.forEach((Z)=>{z.$on(Y,Z)})});if(J.p)z._p=J.p;return z};var m=new Map;var u="\u27B3\u274D",c="\u274D\u21DA",o=`<!--${u}-->`,n=`<!--${c}-->`;var b=D;class L{static messageResponseHandlers=[];static listenMessages(z,H,J){const X=async(Z)=>{const K=Z.data;if(console.log("## GoLingo: message",K,Z),K&&K.uid&&K.functionName){const O=J?.origin||"*";if(!K.isResponse){if(typeof K?.timeout!="undefined")return;const B=setTimeout(()=>{z.postMessage({uid:K.uid,functionName:K.functionName,timeout:!0},O)},J?.timeout||2000);try{const Q=await H(K);console.log("## GoLingo: res",K,Q),z.postMessage({uid:K.uid,functionName:K.functionName,response:Q,isResponse:!0},O)}catch(Q){z.postMessage({uid:K.uid,functionName:K.functionName,response:Q,isResponse:!0},O)}clearTimeout(B)}else{const B=this.messageResponseHandlers.find((Q)=>Q.uid===K.uid);if(B)B.callback(K.response),console.log("## GoLingo: message.response",K.response),this.messageResponseHandlers=this.messageResponseHandlers.filter((Q)=>Q.uid!==K.uid)}}};return window.addEventListener("message",X),()=>{window.removeEventListener("message",X)}}static async sendMessage(z,H,J=null,X){const Y=Math.random().toString(36).substring(7);z.postMessage({uid:Y,functionName:H,args:J},"*"),this.messageResponseHandlers.push({uid:Y,functionName:H,callback:X})}static async send(z,H,J=null){return new Promise((X)=>{L.sendMessage(z,H,J,(Y)=>{X(Y)})})}static getInstance(z){return{send:(H,J)=>{return L.send(z,H,J)},listen:(H,J)=>{return L.listenMessages(z,H,J)}}}}var P=L;class v{constructor(){}code=null;host="http://localhost:3001/";ignoredTags=["iframe","img","style","script","meta","link","head","html","noscript","audio","video","object","canvas","svg","map","area","embed","param","track","source"];data=b({currentLang:null,mainLang:null,translates:{},devMode:!1,selectedTextItem:null,initialized:!1,currentOvrerideLang:null,oldTranslatedPath:null,oldTranslatedLang:null});async init({code:z,host:H}){if(!z){console.error("## GoLingo Error: code is required");return}if(H)this.host=H;if(this.data.initialized){console.info("## GoLingo Error: already initialized");return}this.code=z;const X=new URLSearchParams(window.location.search).get("golingoDev")?!0:!1;if(this.data.devMode=X,X)this.addStyle(),this.listenDevMethods();else this.productionModeListeners();this.observeDOMChanges(),this.data.initialized=!0}addStyle(){if(document.getElementById("golingo-styles"))return;const H=document.createElement("style");H.id="golingo-styles",H.innerHTML=`
            .golingo_highlighted { background-color: #ffff3b24;border: solid 1px #ffff1d; }
            .golingo_disabled { background-color: #afafaf1c;border: solid 1px #818181; }
            .golingo_selected { background-color: #2583c240 !important;border: solid 1px #1d6cd4 !important; }
        `,document.head.appendChild(H)}productionModeListeners(){document.onreadystatechange=async()=>{if(console.log("## GoLingo: document.readyState",document.readyState),document.readyState=="complete")await this.startTranslate()},window.onload=async()=>{await this.startTranslate()};const z=()=>{console.log("Route changed")};window.addEventListener("popstate",z),window.addEventListener("hashchange",z)}listenDevMethods(){const H=P.getInstance(window.parent).listen(async(J)=>{const{uid:X,functionName:Y,args:Z}=J;switch(console.log("## GoLingo: devMethod",J),Y){case"identifyTexts":return await this.identifyTexts(),this.data.identifiedTexts;case"overrideTexts":const K=Z;if(K){this.data.currentOvrerideLang=K,this.data.currentLang=K;const B=this.getPath(),Q=this.data.translates[B][K].texts;console.log("## GoLingo: dev | overrideTexts ",K,JSON.parse(JSON.stringify(this.data.translates,null,2))),this.overrideTexts(Q)}break;case"syncTranslations":const O=Z;if(console.log("## GoLingo: dev",O),O){const{mainLang:B,translations:Q}=O,j=this.getPath();this.data.mainLang=B,this.data.translates[j]=Q}break}});window.addEventListener("beforeunload",()=>{H()})}async identifyTexts(){return this.data.identifiedTexts=A(document.body,this.ignoredTags),this.data.identifiedTexts}overrideTexts(z){if(!this.data.currentLang)return;z.forEach((H)=>{document.querySelectorAll(`#${H.wrapperId}`).forEach((X)=>{if(X&&this.ignoredTags.includes(X.tagName.toLowerCase()))return;if(X&&H.text!=X.textContent)X.textContent=H.text})})}syncTextsWithPanel(){if(this.data.mainLang==this.data.currentLang){const z=this.data.identifiedTexts;this.postDev("syncTexts",z)}}syncInternalLinksWithPanel(){const z=document.querySelectorAll("a"),H=[];z.forEach((X)=>{let Y=X.getAttribute("href")??"";if(Y=Y?.split("?")[0],Y=Y?.split("#")[0],Y&&Y.startsWith("/"))H.push(Y);if(Y&&Y.startsWith(window.location.origin))H.push(Y)});const J=[...new Set(H)];this.postDev("syncLinks",J)}async observeDOMChangesHandler(){if(console.log("## GoLingo: observeDOMChangesHandler"),await this.identifyTexts(),this.data.devMode)this.syncInternalLinksWithPanel(),this.syncTextsWithPanel()}observeDOMChangesDebounced=N(this.observeDOMChangesHandler,300);observeDOMChanges(){new MutationObserver((H,J)=>{this.observeDOMChangesDebounced()}).observe(document.body,{childList:!0,subtree:!0})}getPath(){return window.location.pathname}async postDev(z,H){await P.getInstance(window.parent).send(z,H)}getLocalLang(){const z=navigator.language.split("-"),H=z[0].toLocaleLowerCase(),J=z[1].toLocaleLowerCase();return[H,J]}goLingoLangStorageKey="golingoSelectedLang";getStorageSelectedLang(){return localStorage.getItem(this.goLingoLangStorageKey)}setStorageSelectedLang(z){localStorage.setItem(this.goLingoLangStorageKey,z)}detectCurrentLang(){const z=this.getPath();let H=this.getStorageSelectedLang();if(!this.data.translates?.[z]?.[H])H=this.getLocalLang()[0];this.setCurrentLang(H)}setCurrentLang(z){if(!z)return;this.setStorageSelectedLang(z),this.data.currentLang=z}async loadTranslatesData(){const z=this.getPath(),H=this.code;if(H){const J=await f(this.host,H,z);this.data.translates[z]=J}}async startTranslate(){return}}var i=new v;window.golingo=i;
