var q=function(z,J){let W;return function(...K){const Y=this;clearTimeout(W),W=setTimeout(()=>{z.apply(Y,K)},J)}},g=function(z){const J=[];let W=z;while(W?.parentNode){const K=W.parentNode,Y=Array.from(K.childNodes).filter((X)=>X.nodeName===W?.nodeName).length;let $=0;if(Y>1)$=Array.from(K.childNodes).indexOf(W)-Array.from(K.childNodes).indexOf(W?.nodeName==="#text"?W.previousSibling:W);if(K.nodeType===1){const X=K.getAttribute("id");let Z=(K.nodeName||"").toLowerCase();if(X&&X!=="")Z+=`#${X}`;else if(Y>1)Z+=`:nth-child(${$+1})`;J.unshift(Z)}W=W.parentNode}return J.slice(1).join(" > ").replace(/:nth-child\(1\)/,"")||""},m=function(z){let J=0;if(z.length===0)return J.toString();for(let W=0;W<z.length;W++){const K=z.charCodeAt(W);J=(J<<5)-J+K,J=J&J}return Math.abs(J).toString(16)};var w=function(z){return typeof z==="function"&&!!z.isT},S=function(z){return typeof z==="object"&&z!==null&&("$on"in z)&&typeof z.$on==="function"},n=function(z){return"$on"in z},a=function(z){return(J,W)=>{function K(){const Y=Array.from(V);V.clear();const $=Array.from(k);if(k.clear(),Y.forEach((X)=>X(J,W)),$.forEach((X)=>X()),V.size)setTimeout(K)}if(!V.size)setTimeout(K);V.add(z)}},R=function(z,J={}){if(S(z)||typeof z!=="object")return z;const W=J.o||new Map,K=J.op||new Map,Y=Array.isArray(z),$=[],X=Y?[]:Object.create(z,{});for(let H in z){const B=z[H];if(typeof B==="object"&&B!==null)X[H]=!S(B)?R(B):B,$.push(H);else X[H]=B}const Z=(H)=>(B,A)=>{let Q=W.get(B),j=K.get(A);if(!Q)Q=new Set,W.set(B,Q);if(!j)j=new Set,K.set(A,j);Q[H](A),j[H](B)},G=Z("add"),O=Z("delete"),M=(H,B,A)=>{W.has(H)&&W.get(H).forEach((Q)=>Q(B,A))},U={$on:G,$off:O,_em:M,_st:()=>{return{o:W,op:K,r:X,p:F._p}},_p:void 0},F=new Proxy(X,{has(H,B){return(B in U)||(B in H)},get(...H){const[,B]=H;if(Reflect.has(U,B))return Reflect.get(U,B);const A=Reflect.get(...H);if(r(F,B),Y&&(B in Array.prototype))return t(B,X,F,A);return A},set(...H){const[B,A,Q]=H,j=Reflect.get(B,A);if(Reflect.has(U,A))return Reflect.set(U,A,Q);if(Q&&S(j)){const D=j,P=D._st(),N=S(Q)?e(Q,D):R(Q,P);return Reflect.set(B,A,N),M(A,N),P.o.forEach(($0,f)=>{const v=Reflect.get(j,f),y=Reflect.get(N,f);if(v!==y)D._em(f,y,v)}),!0}const L=Reflect.set(...H);if(L){if(j!==Q)M(A,Q,j);if(F._p)F._p[1]._em(...F._p)}return L}});if(J.p)F._p=J.p;return $.map((H)=>{F[H]._p=[H,F]}),F},r=function(z,J){_.forEach((W)=>{let K=W.get(z);if(!K)K=new Set,W.set(z,K);K.add(J)})},t=function(z,J,W,K){const Y=(...$)=>{const X=Array.prototype[z].call(J,...$);if(J.forEach((Z,G)=>W._em(String(G),Z)),W._p){const[Z,G]=W._p;G._em(Z,W)}return X};switch(z){case"shift":case"pop":case"sort":case"reverse":case"copyWithin":return Y;case"unshift":case"push":case"fill":return(...$)=>Y(...$.map((X)=>R(X)));case"splice":return($,X,...Z)=>Y($,X,...Z.map((G)=>R(G)));default:return K}},e=function(z,J){const W=J._st();if(W.o)W.o.forEach((K,Y)=>{K.forEach(($)=>{z.$on(Y,$)})});if(W.p)z._p=W.p;return z},x=function(z,J){const W=Symbol();if(!_.has(W))_.set(W,new Map);let K=new Map;const Y=a($);function $(){_.set(W,new Map);const X=z(),Z=_.get(W);return _.delete(W),K.forEach((G,O)=>{const M=Z.get(O);if(M)M.forEach((E)=>G.delete(E));G.forEach((E)=>O.$off(E,Y))}),Z.forEach((G,O)=>{G.forEach((M)=>O.$on(M,Y))}),K=Z,J?J(X):X}if(n(z))z.$on($);return $()},l=function(z,...J){const W=[];let K="";const Y=(Z,G)=>{if(typeof Z==="function"){let O=()=>{};return W.push(Object.assign((...M)=>Z(...M),{e:Z,$on:(M)=>{O=M},_up:(M)=>{Z=M,O()}})),G+i}if(Array.isArray(Z))return Z.reduce((O,M)=>Y(M,O),G);return G+Z},$=()=>{if(!K)if(!J.length&&z.length===1&&z[0]==="")K="<!---->";else K=z.reduce(function Z(G,O,M){return G+=O,J[M]!==void 0?Y(J[M],G):G},"");return K},X=(Z)=>{const G=d($()),O=I(G,{i:0,e:W});return Z?O(Z):O()};return X.isT=!0,X._k=0,X._h=()=>[$(),W,X._k],X.key=(Z)=>{return X._k=Z,X},X},I=function(z,J){const W=document.createDocumentFragment();let K;while(K=z.item(0)){if(K.nodeType===8&&K.nodeValue===c){W.append(X0(K,J));continue}if(K instanceof Element)J0(K,J);if(K.hasChildNodes())I(K.childNodes,J)(K);if(W.append(K),K instanceof HTMLOptionElement)K.selected=K.defaultSelected}return(Y)=>{if(Y)return Y.appendChild(W),Y;return W}},J0=function(z,J){var W;const K=[];let Y=0,$;while($=z.attributes[Y++]){if(J.i>=J.e.length)return;if($.value!==i)continue;let X=$.name;const Z=J.e[J.i++];if(X.charAt(0)==="@"){const G=X.substring(1);if(z.addEventListener(G,Z),!C.has(z))C.set(z,new Map);(W=C.get(z))===null||W===void 0||W.set(G,Z),K.push(X)}else{const G=X==="value"&&("value"in z)||X==="checked"||X.startsWith(".")&&(X=X.substring(1));x(Z,(O)=>{if(G){if(z[X]=O,z.getAttribute(X)!=O)O=!1}O!==!1?z.setAttribute(X,O):(z.removeAttribute(X),Y--)})}}K.forEach((X)=>z.removeAttribute(X))},K0=function(z){z.forEach(W0)},W0=function(z){var J;z.remove(),(J=C.get(z))===null||J===void 0||J.forEach((W,K)=>z.removeEventListener(K,W))},X0=function(z,J){const W=document.createDocumentFragment();z.remove();const K=J.e[J.i++];if(K&&w(K.e))W.appendChild(b().add(K.e)());else{let Y;W.appendChild((Y=x(K,($)=>Y0($,Y)))())}return W},Y0=function(z,J){const W=typeof J==="function",K=W?J:b();if(Array.isArray(z)?z.forEach((Y)=>K.add(Y)):K.add(z),W)K._up();return K},d=function(z){var J;const K=((J=h[z])!==null&&J!==void 0?J:(()=>{const Y=document.createElement("template");return Y.innerHTML=z,h[z]=Y})()).content.cloneNode(!0);return K.normalize(),K.childNodes},b=function(z=Symbol()){let J="",W={i:0,e:[]},K=[],Y=[];const $=new Map,X=[],Z=()=>{let U;if(!K.length)O();if(K.length===1&&!w(K[0].tpl)){const F=K[0];F.dom.length?F.dom[0].nodeValue=F.tpl:F.dom.push(document.createTextNode(F.tpl)),U=F.dom[0]}else U=M(I(d(J),W)());return G(),U};Z.ch=()=>Y,Z.l=0,Z.add=(U)=>{if(!U&&U!==0)return Z;let F=[],H,B="";if(w(U))[B,F,H]=U._h();J+=B,J+=z0;const A=H&&$.get(H),Q=A||{html:B,exp:F,dom:[],tpl:U,key:H};if(K.push(Q),H)A?A.exp.forEach((j,L)=>j._up(F[L].e)):$.set(H,Q);return W.e.push(...F),Z.l++,Z},Z._up=()=>{const U=b(z);let F=0,H=Y[0].dom[0];if(!K.length)O(document.createComment(""));const B=()=>{if(!U.l)return;const Q=U(),j=Q.lastChild;H[F?"after":"before"](Q),E(U,K,F),H=j};K.forEach((Q,j)=>{const L=Y[j];if(Q.key&&Q.dom.length){if(B(),!L||L.dom!==Q.dom)H[j?"after":"before"](...Q.dom);H=Q.dom[Q.dom.length-1]}else if(L&&Q.html===L.html&&!L.key){if(B(),L.exp.forEach((D,P)=>D._up(Q.exp[P].e)),Q.exp=L.exp,Q.dom=L.dom,H=Q.dom[Q.dom.length-1],Z0(Q)&&H instanceof Text)H.nodeValue=Q.tpl}else{if(L&&Q.html!==L.html&&!L.key)X.push(...L.dom);if(!U.l)F=j;U.add(Q.tpl)}}),B();let A=H===null||H===void 0?void 0:H.nextSibling;while(A&&(z in A))X.push(A),A=A.nextSibling;K0(X),G()};const G=()=>{X.length=0,J="",Z.l=0,W={i:0,e:[]},Y=[...K],K=[]},O=(U)=>{J="<!---->",K.push({html:J,exp:[],dom:U?[U]:[],tpl:l`${J}`,key:0})},M=(U)=>{let F=0;const H=[];return U.childNodes.forEach((B)=>{if(B.nodeType===8&&B.data===u){F++,H.push(B);return}Object.defineProperty(B,z,{value:z}),K[F].dom.push(B)}),H.forEach((B)=>B.remove()),U},E=(U,F,H)=>{U.ch().forEach((B,A)=>{F[H+A].dom=B.dom})};return Z},Z0=function(z){return z.dom.length===1&&!w(z.tpl)},V=new Set,k=new Set;var _=new Map,C=new WeakMap,h={},c="\u27B3\u274D",u="\u274D\u21DA",i=`<!--${c}-->`,z0=`<!--${u}-->`,T=l,s=R;var H0="http://localhost:3001/";class p{constructor(){}code=null;texts=[];currentLang=null;translatedTo=null;oldTranslatedPath=null;mainLang=null;translates={};disabledItems=[];ignoredTags=["iframe","img","style","script","meta","link","head","html","noscript","audio","video","object","canvas","svg","map","area","embed","param","track","source"];devMode=!1;initialized=!1;selectedTextItem=null;reactiveData=s({currentLang:this.currentLang,translates:this.translates});async init({code:z}){if(!z){console.error("## GoLingo Error: code is required");return}if(this.initialized){console.info("## GoLingo Error: already initialized");return}this.code=z;const W=new URLSearchParams(window.location.search).get("golingoDev")?!0:!1;if(this.devMode=W,W)console.info("## GoLingo Dev Mode");if(W)this.addStyle(),this.registerDevEvents();if(this.observeDOMChanges(),this.detectAllTexts(),console.info(`%cGoLingo %c${this.code}`,"background: #2ecc71; color: #fff; padding: 2px 4px; border-radius: 3px 0 0 3px;","background: #3498db; color: #fff; padding: 2px 4px; border-radius: 0 3px 3px 0;"),this.initialized=!0,console.log("path",this.getPath()),!W){document.onreadystatechange=async()=>{if(console.log("## GoLingo: document.readyState",document.readyState),document.readyState=="complete")await this.startTranslate()},window.onload=async()=>{await this.startTranslate()};const K=()=>{this.translatedTo=null,console.log("Route changed")};window.addEventListener("popstate",K),window.addEventListener("hashchange",K)}}getPath(){return window.location.pathname}async loadData(){const z=this.getPath();console.log("## GoLingo: path",z);const W=await(await fetch(`${H0}api/tr?code=${this.code}&path=${z}`)).json();this.mainLang=W.mainLang;let K=W.translates;for(let Y of Object.keys(K))K[Y].texts=K[Y].texts.filter(($,X,Z)=>Z.findIndex((G)=>G.wrapperId===$.wrapperId)===X);this.translates[z]=K,this.reactiveData.translates[z]=K,this.addBasicLanguageSelector()}async startTranslate(){const z=this.getPath();if(this.oldTranslatedPath!==z)this.translatedTo=null;if(Object.keys(this.translates?.[z]??{}).length==0)await this.loadData();if(this.findCurrentLang(),this.detectAllTexts(),console.log("## GoLingo: startTranslate",this.texts,this.translates[z],this.currentLang,this.translatedTo),this.translates?.[z]?.[this.currentLang]&&this.translatedTo!==this.currentLang)this.overrideTexts(),this.translatedTo=this.currentLang,this.oldTranslatedPath=z}detectAllTexts(){return this.texts=this.detectTexts(document.body,this.ignoredTags),this.texts}onResize(){this.detectAllTexts(),this.syncTextsDebounced()}resizeDebounced=q(this.onResize,500);registerDevEvents(){window.addEventListener("resize",this.resizeDebounced),window.addEventListener("message",(z)=>{const J=z.data;if(J){const W=J.type;if(W)switch(W){case"sync-translations":const K=this.getPath();if(this.translates[K]=J.data.translates,console.log(" GoLingo: sync-translations",{...J.data}),this.setCurrentLang(J.data.currentLang),this.mainLang=J.data.mainLang,this.mainLang&&this.translates?.[K]?.[this.mainLang]!=null)this.detectAllTexts(),this.overrideTexts();break;case"requestInternalLinks":this.detectInternalLinks();break}}})}addStyle(){const z=document.createElement("style");z.innerHTML=`
            .golingo_highlighted { background-color: #ffff3b24;border: solid 1px #ffff1d; }
            .golingo_disabled { background-color: #afafaf1c;border: solid 1px #818181; }
            .golingo_selected { background-color: #2583c240 !important;border: solid 1px #1d6cd4 !important; }
        `,document.head.appendChild(z)}detectInternalLinks(){const z=document.querySelectorAll("a"),J=[];z.forEach((K)=>{let Y=K.getAttribute("href")??"";if(Y=Y?.split("?")[0],Y=Y?.split("#")[0],Y&&Y.startsWith("/"))J.push(Y);if(Y&&Y.startsWith(window.location.origin))J.push(Y)});const W=[...new Set(J)];return this.postDev("syncInternalLinks",W),J}postDev(z,J){window.parent.postMessage({from:"golingo",type:z,data:J},"*")}textItemToDev(z){let J=null;if(z.node instanceof Element&&z.node.id)J={id:z.node.id,tagName:z.node.tagName,className:z.node.className};return{wrapperId:z.wrapper.id,text:z.wrapper.textContent||"",node:J,position:z.position}}toggleTextItem(z,J){if(this.disabledItems.indexOf(z)!==-1===J)return;if(J)this.disabledItems.push(z);else this.disabledItems=this.disabledItems.filter((K)=>K!==z);document.getElementById(z)?.classList.toggle("golingo_disabled",J)}syncTexts=()=>{let z=this.texts.map((J)=>{let W;if(J.node instanceof Element&&J.node.id)W={id:J.node.id,tagName:J.node.tagName,className:J.node.className};return{wrapperId:J.wrapper.id,text:J.wrapper.textContent||"",node:W,position:J.position}});this.postDev("syncTexts",z)};syncTextsDebounced=q(this.syncTexts,500);selectTextItem(z){if(this.postDev("select-text",this.textItemToDev(z)),this.selectedTextItem)this.selectedTextItem.wrapper.classList.remove("golingo_selected");z.wrapper.classList.add("golingo_selected"),this.selectedTextItem=z}detectTextsDebounced=q(this.detectAllTexts,500);overrideTextsDebounced=q(this.overrideTexts,100);overrideTexts(){if(!this.currentLang)return;const z=this.getPath();(this.translates?.[z]?.[this.currentLang]?.texts??[]).forEach((W)=>{const K=document.getElementById(W.wrapperId);if(K&&this.ignoredTags.includes(K.tagName.toLowerCase()))return;if(K&&W.text!=K.textContent)console.log("## GoLingo: overrideTexts",W.text," with ",K.textContent,W.text==K.textContent),K.textContent=W.text})}detectTexts(z,J){let W=[];const K=z?.tagName?.toLowerCase()??"";if(z.nodeType===3){const Y=(z.nodeValue||"").trim();if(Y.length<=2)return[];if(Y!==""){const $=z.parentNode.classList.contains("golingo_highlighted");let X;if($)X=z.parentNode;else{X=document.createElement("span");const O=m(Y);X.id=`golingo_highlighted_${O}`,X.className="golingo_highlighted",X.textContent=Y}const Z=g(z.parentNode);if(z.parentNode&&!$)z.parentNode.replaceChild(X,z);const G={wrapper:X,node:z,position:Z,text:Y};if(W.push(G),this.devMode&&!$)X.addEventListener("click",(O)=>{O.stopPropagation(),this.selectTextItem(G)})}}else if(z.nodeType===1&&!J.includes(K)){const Y=z;for(let $=0;$<Y.childNodes.length;$++){let X=this.detectTexts(Y.childNodes[$],J);W.push(...X)}}return W}observeDOMChangesHandler(){if(console.log("## GoLingo: observeDOMChangesHandler"),this.detectAllTexts(),this.devMode)this.detectInternalLinks(),this.syncTextsDebounced();else this.startTranslate()}observeDOMChangesDebounced=q(this.observeDOMChangesHandler,500);observeDOMChanges(){new MutationObserver((J,W)=>{if(this.mainLang!==this.currentLang);this.observeDOMChangesDebounced()}).observe(document.body,{childList:!0,subtree:!0})}getLocalLang(){const z=navigator.language.split("-"),J=z[0].toLocaleLowerCase(),W=z[1].toLocaleLowerCase();return[J,W]}goLingoLangStorageKey="golingoSelectedLang";getStorageSelectedLang(){return localStorage.getItem(this.goLingoLangStorageKey)}setStorageSelectedLang(z){localStorage.setItem(this.goLingoLangStorageKey,z)}findCurrentLang(){const z=this.getPath();let J=this.getStorageSelectedLang();if(!this.translates?.[z]?.[J])J=this.getLocalLang()[0];this.setCurrentLang(J)}setCurrentLang(z){if(!z)return;this.currentLang=z,this.reactiveData.currentLang=z}switchLanguage(z){if(this.currentLang===z)return;if(!this.translates?.[this.getPath()]?.[z])return;this.setCurrentLang(z),this.setStorageSelectedLang(z),this.startTranslate()}addBasicLanguageSelector(){if(document.querySelector(".golingo-lang-selector"))return;const W=this.getPath();let K=this.translates[W]?Object.keys(this.translates[W]):[];if(this.mainLang)K=K.filter((X)=>X!==this.mainLang),K.unshift(this.mainLang);if(K.length==0)return;this.findCurrentLang(),console.log("## GoLingo: addBasicLanguageSelector",this.currentLang,K,this.translates[W]);const Y=(X)=>{return this.translates[W][X].name};T`${()=>{const X=this.getPath(),Z=Object.keys(this.reactiveData.translates[X]);return console.log("langs",Z),T`<div class="${"golingo-lang-selector"}">
                <style>
                .${"golingo-lang-selector"} {
                    position: fixed;
                    bottom: 8px;
                    left: 8px;
                    z-index: 9999;
                    font-size: 14px;
                    font-weight: bold;
                    padding: 0px 12px;
                    background: #F5F5F5;
                    border-radius: 12px;
                    box-shadow: 0px 0px 8px 0px #0000001c;
                    border: 1px solid #DFDFDF;
                } 
                .${"golingo-lang-selector"} .golingo-select-lang {
                    background: transparent;
                    width: 100%;
                    padding: 8px 16px;
                    cursor: pointer;
                    outline: none;
                    border: none;
                }
                </style>
                ${()=>{return T`<select class="golingo-select-lang" @change="${(G)=>{o.switchLanguage(G.target.value)}}">
                    ${Z.map((G)=>{return T`<option value="${G}" selected="${()=>G===this.reactiveData.currentLang}">${Y(G)}</option>`})}
                </select>`}}
                </div>`}}`(document.body)}events={};emit(z,J){if(!this.events[z])return;this.events[z].forEach((W)=>{W(J)})}on(z,J){if(!this.events[z])this.events[z]=[];this.events[z].push(J)}}var o=new p;window.golingo=o;
